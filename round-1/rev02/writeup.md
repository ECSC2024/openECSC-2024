# openECSC 2024 - Round 1

## [rev] fsvm 2 (66 solves)

I wrote an improved version of my previous VM, but it's still not capable of printing good descriptions.

Author: Matteo Protopapa <@matpro>

## Overview

The challenge consists of two files: an ELF that implements a virtual machine and a binary file containing a bytecode. If we run the challenge with the command `./vm bytecode`, the progaram tries to read a file, then it prints "Correct!" or "Wrong!" based on the content of the file. If the file doesn't exist, the program prints "File_not_found".

## Solution

The VM implements some more instructions with respect to the previous challenge `fsvm`, again with the peculiarity that the "registers" are text files.

In this case, the programs builds the string "flag.txt" and tries to read that file. If it success, then it computes the length of the string contained in the file and checks if it's 37.

Then, the program multiply each character of the flag by a different number, and sums all the obtained values. The result is compared with a new integer. This is repeated 37 times, thus resulting in a multiplication between a `37x37` matrix and the vector of the ASCII values of the flag's characters. The resulting vector is compared to a new vector.

The `37x37` matrix has rank 37, so we can recover the flag from the retrieved values.

In the proposed solution, we add 0.5 to the recovered values to compensate precision issues. Implementing the same solution with SageMath does not require this.

## Exploit

```python
import numpy as np

m = [[44, 61, 10, 51, 95, 1, 99, 28, 26, 70, 1, 95, 97, 59, 76, 17, 37, 79, 94, 35, 97, 83, 34, 66, 27, 1, 79, 1, 46, 26, 41, 39, 58, 79, 70, 46, 74],
 [45, 9, 45, 60, 72, 94, 70, 32, 3, 71, 96, 61, 6, 7, 4, 66, 98, 92, 32, 46, 38, 48, 80, 27, 61, 62, 80, 44, 78, 94, 42, 26, 1, 92, 4, 74, 48],
 [1, 42, 67, 65, 30, 65, 28, 37, 1, 35, 88, 83, 27, 73, 5, 79, 12, 42, 7, 22, 42, 34, 23, 92, 66, 78, 49, 23, 30, 72, 26, 87, 40, 9, 63, 75, 64],
 [29, 2, 29, 7, 19, 48, 92, 47, 92, 28, 55, 25, 36, 47, 32, 44, 34, 96, 63, 5, 84, 57, 85, 47, 14, 7, 44, 37, 76, 90, 51, 53, 29, 73, 45, 85, 75],
 [91, 17, 46, 37, 67, 31, 55, 47, 61, 39, 99, 11, 92, 20, 90, 6, 62, 25, 87, 8, 67, 8, 7, 26, 58, 70, 80, 84, 49, 97, 95, 70, 11, 4, 57, 43, 52],
 [63, 79, 92, 32, 70, 32, 87, 23, 70, 36, 40, 65, 40, 15, 76, 74, 86, 12, 59, 22, 55, 1, 18, 58, 12, 7, 16, 6, 19, 32, 44, 29, 31, 17, 49, 70, 40],
 [52, 43, 76, 55, 55, 27, 57, 93, 26, 3, 10, 12, 86, 42, 83, 37, 6, 35, 74, 93, 32, 6, 49, 11, 96, 78, 73, 46, 71, 85, 100, 48, 80, 84, 38, 38, 99],
 [96, 9, 91, 56, 62, 94, 1, 80, 30, 84, 83, 38, 84, 39, 45, 63, 63, 35, 25, 58, 41, 22, 48, 15, 83, 94, 88, 55, 73, 69, 24, 1, 40, 83, 21, 41, 15],
 [6, 51, 44, 34, 51, 43, 75, 87, 87, 48, 11, 98, 57, 95, 95, 12, 9, 83, 61, 23, 29, 37, 8, 58, 13, 77, 35, 35, 10, 79, 90, 5, 31, 37, 3, 3, 63],
 [95, 55, 15, 73, 73, 3, 85, 45, 43, 64, 37, 52, 77, 24, 7, 26, 1, 11, 75, 14, 25, 43, 29, 53, 81, 48, 57, 98, 69, 79, 24, 44, 100, 63, 10, 75, 80],
 [8, 70, 53, 77, 39, 19, 42, 70, 52, 37, 33, 88, 81, 90, 39, 44, 86, 45, 36, 39, 84, 98, 58, 74, 77, 10, 79, 74, 65, 21, 59, 89, 91, 24, 42, 96, 76],
 [55, 23, 36, 18, 84, 54, 100, 99, 94, 52, 13, 9, 25, 38, 45, 30, 35, 76, 46, 95, 6, 36, 31, 15, 80, 36, 69, 21, 90, 13, 100, 47, 10, 34, 58, 69, 38],
 [17, 58, 42, 65, 5, 46, 63, 7, 21, 89, 83, 70, 36, 8, 28, 20, 54, 48, 79, 76, 86, 30, 83, 57, 35, 92, 33, 99, 99, 63, 76, 57, 50, 64, 37, 22, 34],
 [15, 30, 68, 60, 91, 59, 31, 94, 69, 81, 47, 17, 4, 37, 25, 32, 1, 1, 61, 79, 31, 77, 86, 2, 15, 82, 12, 32, 95, 5, 55, 90, 43, 45, 22, 97, 99],
 [14, 40, 60, 40, 9, 83, 33, 30, 38, 72, 61, 11, 19, 18, 21, 87, 55, 95, 85, 61, 38, 51, 2, 86, 17, 62, 35, 90, 72, 8, 51, 34, 89, 78, 62, 64, 100],
 [51, 20, 97, 12, 67, 22, 9, 18, 48, 46, 19, 57, 62, 68, 56, 24, 70, 97, 7, 14, 73, 51, 18, 64, 29, 76, 62, 38, 7, 13, 43, 91, 6, 19, 54, 76, 100],
 [7, 2, 83, 45, 79, 32, 63, 40, 27, 76, 4, 97, 86, 50, 79, 52, 18, 61, 88, 26, 46, 42, 50, 1, 48, 61, 25, 87, 26, 81, 15, 91, 21, 42, 51, 83, 71],
 [41, 84, 87, 91, 42, 86, 42, 82, 52, 97, 54, 95, 13, 77, 59, 57, 71, 27, 69, 22, 15, 29, 57, 98, 73, 52, 50, 78, 68, 7, 32, 47, 92, 57, 58, 32, 47],
 [74, 86, 25, 80, 58, 82, 71, 6, 60, 35, 20, 21, 1, 26, 70, 49, 38, 46, 98, 100, 36, 92, 88, 34, 70, 68, 16, 28, 44, 31, 22, 74, 46, 98, 30, 43, 57],
 [80, 14, 97, 78, 71, 14, 76, 47, 49, 62, 57, 91, 58, 11, 48, 44, 36, 5, 52, 83, 26, 93, 70, 52, 30, 38, 47, 58, 11, 56, 28, 36, 97, 33, 12, 98, 70],
 [99, 91, 16, 96, 98, 30, 7, 28, 39, 88, 21, 1, 39, 94, 62, 27, 55, 3, 53, 92, 40, 42, 42, 10, 7, 42, 29, 6, 10, 82, 92, 27, 40, 13, 5, 98, 43],
 [41, 78, 90, 69, 83, 57, 57, 11, 51, 15, 5, 83, 5, 21, 37, 24, 51, 94, 88, 99, 14, 43, 86, 30, 48, 12, 69, 25, 51, 62, 85, 68, 5, 16, 63, 46, 66],
 [50, 60, 33, 31, 18, 31, 12, 63, 2, 79, 33, 88, 85, 72, 6, 87, 63, 84, 53, 47, 36, 100, 85, 35, 6, 81, 14, 7, 12, 94, 7, 7, 99, 7, 37, 80, 72],
 [34, 40, 62, 45, 54, 68, 31, 19, 42, 55, 3, 14, 32, 98, 10, 28, 45, 64, 63, 25, 13, 47, 66, 67, 15, 42, 12, 14, 35, 68, 42, 9, 79, 28, 48, 45, 47],
 [98, 59, 55, 17, 67, 38, 53, 1, 54, 59, 35, 92, 30, 64, 43, 63, 73, 31, 72, 57, 2, 18, 45, 71, 10, 36, 35, 2, 28, 68, 14, 79, 37, 16, 33, 60, 88],
 [15, 13, 10, 98, 65, 69, 24, 3, 60, 51, 100, 89, 63, 96, 37, 31, 26, 36, 23, 65, 26, 89, 41, 40, 66, 24, 94, 50, 98, 7, 99, 4, 60, 30, 96, 71, 41],
 [21, 13, 89, 100, 38, 46, 96, 68, 15, 18, 48, 77, 7, 100, 8, 70, 69, 54, 55, 87, 2, 72, 33, 73, 17, 13, 69, 6, 86, 52, 69, 11, 97, 25, 54, 96, 7],
 [23, 40, 57, 66, 64, 39, 73, 21, 77, 96, 45, 11, 95, 45, 81, 23, 77, 60, 61, 81, 23, 8, 39, 18, 97, 30, 28, 96, 62, 16, 83, 55, 2, 4, 7, 41, 48],
 [78, 55, 58, 47, 55, 21, 59, 75, 79, 35, 45, 95, 71, 72, 6, 25, 75, 34, 39, 56, 58, 31, 75, 99, 79, 11, 66, 14, 53, 30, 82, 73, 77, 61, 74, 46, 62],
 [12, 3, 80, 92, 41, 96, 98, 90, 17, 57, 32, 40, 86, 52, 65, 29, 68, 12, 59, 32, 10, 63, 49, 34, 6, 97, 64, 29, 44, 13, 67, 37, 49, 5, 2, 45, 28],
 [3, 19, 16, 91, 99, 38, 77, 39, 29, 61, 23, 2, 19, 25, 71, 11, 49, 34, 81, 67, 42, 78, 49, 69, 3, 28, 48, 91, 47, 68, 26, 28, 54, 22, 88, 56, 41],
 [66, 56, 21, 45, 41, 28, 18, 4, 7, 29, 83, 24, 66, 93, 25, 70, 33, 70, 3, 73, 47, 10, 78, 24, 9, 17, 39, 28, 51, 45, 79, 33, 7, 44, 65, 58, 77],
 [89, 87, 17, 89, 77, 80, 95, 42, 94, 98, 32, 25, 27, 98, 76, 20, 25, 68, 24, 8, 85, 75, 7, 98, 47, 70, 33, 8, 65, 2, 48, 23, 26, 7, 4, 51, 14],
 [82, 9, 29, 44, 26, 80, 36, 61, 100, 50, 19, 1, 85, 60, 43, 39, 2, 93, 6, 55, 32, 44, 79, 37, 65, 40, 48, 70, 85, 98, 99, 99, 6, 95, 31, 3, 66],
 [49, 37, 77, 96, 29, 92, 32, 34, 42, 50, 60, 41, 96, 51, 100, 19, 87, 15, 85, 13, 96, 73, 95, 88, 86, 51, 69, 19, 17, 10, 24, 44, 36, 80, 36, 66, 72],
 [33, 90, 76, 98, 8, 80, 5, 6, 29, 95, 25, 34, 57, 25, 47, 59, 49, 3, 9, 10, 86, 10, 97, 29, 21, 26, 59, 100, 93, 22, 87, 33, 11, 84, 72, 5, 48],
 [28, 33, 5, 15, 13, 39, 33, 52, 47, 28, 47, 89, 61, 2, 76, 88, 73, 61, 15, 70, 15, 59, 71, 57, 65, 42, 21, 69, 87, 86, 1, 99, 76, 84, 26, 18, 34]]

v = [172921, 165441, 154900, 154675, 164170, 140999, 181364, 176240, 153637, 168892, 199062, 158610, 170073, 157596, 168574, 152795, 162218, 198124, 175299, 179403, 145075, 168661, 161959, 134271, 155510, 182674, 169645, 162123, 188831, 151273, 149344, 145154, 167698, 172352, 187042, 155223, 164628]

m = np.array(m)
v = np.array(v)

f = np.linalg.solve(m, v)
print(f)
print(''.join(chr(int(c+0.5)) for c in f))
```
